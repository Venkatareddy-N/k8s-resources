Static Provisioning
====================
EBS
---
1. Create volume manually 
volume id : vol-0f41d920c840991da

2. we need to install the drivers

ebs csi driver

https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/docs/install.md  --> find link here

kubectl apply -k "github.com/kubernetes-sigs/aws-ebs-csi-driver/deploy/kubernetes/overlays/stable/?ref=release-1.36"  --> drivers link 

kubectl get pods -n kube-system --> here is running admin related pods.

3. EKS nodes should have permissions to access EBS volumes.

we have one iam role attached to the ec2 instances, to that iam attach a policy 
AmazonEBSCSIDriverPolicy

---------------------

persistant volume and persistant volume claim (PV, PVC)

K8 created a wrapper objets to manage underlying volumes, because k8 engineer will not have full idea on volumes.

PV --> it represents tha physical storage like EBS/EFS

apiVersion: v1
kind: PersistentVolume
metadata:
  name: ebs-static
spec:
  accessModes:
  - ReadWriteOnce
  capacity:
    storage: 20Gi
  csi:
    driver: ebs.csi.aws.com
    fsType: ext4
    volumeHandle: vol-0f41d920c840991da

kubectl apply -f 01-ebs-static.yaml

kubectl get pv --> to see all pv's

apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: ebs-static
spec:
  storageClassName: ""
  volumeName: ebs-static
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi

kubectl get pvc

kubectl describe pvc ebs-static

apiVersion: v1
kind: Pod
metadata:
  name: ebs-static
spec:
  containers:
  - name: nginx
    image: nginx
    volumeMounts:  # docekr run -v hostpath:containserpath
    - name: persistent-storage
      mountPath: /usr/share/nginx/html
  volumes:
  - name: ebs-static
    persistentVolumeClaim:
      claimName: ebs-static


kubectl get pods -o wide

kubectl get pods

kubectl get nodes --show-labels

topology.kubernetes.io/zone=us-east-1c

